<div class="container mx-auto p-6">
  <h1 class="text-4xl font-extrabold text-gray-900 mb-8">Your Orders</h1>

  <!-- Loading state -->
  <div *ngIf="loading" class="flex justify-center items-center py-10">
    <div class="text-gray-500 text-lg">Loading orders...</div>
  </div>

  <!-- No orders message -->
  <div *ngIf="!loading && orders.length === 0" class="bg-yellow-100 text-yellow-700 border border-yellow-300 p-4 rounded-md shadow-md">
    <p class="font-semibold">No orders found.</p>
  </div>

  <!-- Orders list -->
  <div *ngIf="!loading && orders.length > 0">
    <div *ngFor="let order of orders" class="bg-white shadow-lg rounded-lg mb-6 p-6 transition-transform transform hover:scale-105 duration-200">
      <!-- Order header -->
      <div class="flex justify-between items-center border-b pb-4 mb-4">
        <div>
          <h2 class="text-xl font-semibold text-gray-800">
            Order #{{ order.orderId }}
          </h2>
          <p class="text-sm text-gray-500">Placed on {{ order.orderDate | date: 'mediumDate' }}</p>
        </div>
        <span
          class="px-3 py-1 text-sm font-medium rounded-full"
          [ngClass]="{
            'bg-green-100 text-green-700': order.status === 'Completed',
            'bg-yellow-100 text-yellow-700': order.status === 'Pending Payment',
            'bg-red-100 text-red-700': order.status === 'Cancelled',
            'bg-blue-100 text-blue-700': order.status === 'Shipped'
          }"
        >
          {{ order.status }}
        </span>
      </div>

      <!-- If order has no items, display out-of-stock message -->
      <div *ngIf="order.orderItems.length === 0" class="bg-red-100 text-red-700 border border-red-300 p-4 rounded-md shadow-md">
        <p class="font-semibold">Product is out of stock.</p>
      </div>

      <!-- Show order details only if order items exist -->
      <div *ngIf="order.orderItems.length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <p class="text-sm text-gray-600">
            <strong>Total Amount:</strong> <span class="text-lg font-semibold text-blue-600">${{ order.totalAmount }}</span>
          </p>
          <p class="text-sm text-gray-600">
            <strong>Shipping Address:</strong> <span class="text-gray-800">{{ order.shippingAddress }}</span>
          </p>
          <p class="text-sm text-gray-600">
            <strong>Pin Code:</strong> <span class="text-gray-800">{{ order.pinCode }}</span>
          </p>
        </div>

        <div>
          <h3 class="text-sm font-semibold text-gray-700 mb-2">Order Items:</h3>
          <ul class="text-sm text-gray-600 space-y-2">
            <li *ngFor="let item of order.orderItems" class="flex justify-between items-center border-b pb-2">
              <span>{{ item.product.name }} (x{{ item.quantity }})</span>
              <span class="text-blue-600">${{ item.totalPrice }}</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- Payment Button (only shown if the order status is 'Pending Payment' and order has items) -->
      <div *ngIf="order.status === 'Pending Payment' && order.orderItems.length > 0" class="mt-4 text-right">
        <button
          class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200"
          (click)="storePaymentDetailsAndRedirect(order.orderId, order.totalAmount)"
        >
          Make Payment
        </button>
      </div>

      <!-- Delete Order Button (always shown) -->
      <div class="mt-4 text-right">
        <button
          class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200"
          (click)="deleteOrder(order.orderId)"
        >
          Cancel Order
        </button>
      </div>
    </div>
  </div>
</div>
